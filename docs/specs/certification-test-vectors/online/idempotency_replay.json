{
  "description": "Idempotent replay of identical authorization request",
  "request": {
    "method": "POST",
    "url": "/v1/transactions/authorize",
    "headers": {
      "Idempotency-Key": "test-replay-001",
      "X-Request-Id": "550e8400-e29b-41d4-a716-446655440007",
      "X-Acquirer-Id": "acq_123",
      "X-Merchant-Id": "m_123",
      "X-Terminal-Id": "t_456",
      "X-JWS-Signature": "eyJhbGciOiJFUzI1NiJ9..."
    },
    "body": {
      "amount": { "value": "12.34", "currency": "EUR" },
      "merchant": { "merchant_id": "m_123", "category_code": "5411" },
      "terminal": { "terminal_id": "t_456", "capabilities": ["NFC", "CHIP", "OFFLINE"] },
      "payer": { "instrument_type": "TEUR_WALLET", "wallet_token": "valid_token_123" },
      "risk": { "device_attestation": "attest_123", "offline_eligible": true },
      "metadata": { "local_txn_time_utc": "2026-01-03T13:40:12Z" }
    }
  },
  "expected_response": {
    "status": 200,
    "body": {
      "auth": {
        "decision": "APPROVED",
        "auth_code": "A12345",
        "expires_at_utc": "2026-01-03T14:40:12Z"
      },
      "ledger": {
        "txn_id": "550e8400-e29b-41d4-a716-446655440008",
        "status": "AUTHORIZED"
      }
    }
  },
  "expected_scheme_code": null,
  "expected_audit_events": [
    {
      "event_type": "TRANSACTION_AUTHORIZE",
      "correlation_id": "550e8400-e29b-41d4-a716-446655440007",
      "actor": "acq_123"
    }
  ]
}